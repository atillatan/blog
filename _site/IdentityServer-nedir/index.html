<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.9.0/github-markdown.min.css" integrity="sha256-AcEoN20lbehGx2iA6fVk4geoblRBOAUmz+gEM9QE59Y=" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/7.1.0/mermaid.min.js" integrity="sha256-M3OC0Q6g4/+Q4j73OvnsnA+lMkdAE5KgupRHqTiPbnI=" crossorigin="anonymous"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
  <link rel="stylesheet" href="/assets/css/core.css"/>
  <link rel="stylesheet" href="/assets/css/site.css"/>
    <link rel="stylesheet" href="/assets/style.css"/>
  <link rel="shortcut icon" href="/favicon.ico" />
  <meta name="robots" content="index, follow">
  <meta name="author" content="Atilla Tanrikulu" />
  <meta name="description" content="atilla.tanrikulu.biz | Bir çok kategoride güzel ve özgün makaleler okuyabileceğiniz güncel bir blog."/>
  <title>IdentityServer Nedir. Atilla Tanrikulu</title>
  <base href="">
</head>


  <body>
    <header class="container">
           <nav class="navbar navbar-inverse container-fluid navbar-fixed-top">
  <div>
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
              <span class="sr-only">Menü</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
          </button>
      <a class="navbar-brand" href="/">Atilla Tanrıkulu</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/"><span class="glyphicon glyphicon-home"></span>Anasayfa</a></li>
        <li><a href="/about/"><span class="glyphicon glyphicon-king"></span>Hakkında</a></li>

      </ul>
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group-sm">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Aranacak ifade">
            <span class="input-group-btn"><button class="btn btn-success btn-sm">Ara!</button></span>
          </div>
        </div>

      </form>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/contact/"><span class="glyphicon glyphicon-envelope"></span> İletişim</a></li>
        <li><a href="http://www.filehoo.com"><span class="glyphicon glyphicon-link"></span> Filehoo</a></li>
      </ul>

    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container-fluid -->
</nav>

    </header>
        <section class="container">
            <div class="row">
                <div class="col-md-3">
                   <div class="panel panel-default">
     <div class="panel-heading text-center"><img class="img-responsive img-circle" src="/assets/img/linkedin_profile_photo.jpg" style="padding-left:30px;padding-right:30px;"/>
       <h2>Atilla Tanrikulu</h2>
       <ul class="nav navbar-nav text-center">
         <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
           <li><a href="https://www.linkedin.com/in/atillatan" target="_blank"><i class="fa fa-linkedin-square fa-2x social"></i></a></li>
           <li><a href="https://twitter.com/atillatanrikulu" target="_blank"><i class="fa fa-twitter-square fa-2x social"></i></a></li>
           <li><a href="mailto:info@tanrikulu.biz" target="_blank"><i class="fa fa-envelope-square fa-2x social"></i></a></li>
       </ul>
     </div>
     <div class="panel-body text-left">
         <div class="row">
             <div class="col-md-12 ">
               <p>
                Bu kişisel blog sitesindeki makaleler, genellikle iş hayatımda unutmak istemediğim bilgileri
                 not alma isteğim sonucunda oluşmuştur.
              </p>
             </div>

         </div>
     </div>
 </div>

                   <!-- Panel -->
<div class="panel panel-default" style="margin-bottom:0px;">
  <div class="panel-heading">
    <h4 class="panel-title">Makaleler</h4>
  </div>

</div>
<div class="list-group">


<a class="list-group-item" href="/Duckdns-ile-Dinamik-IP-adresinize-Alan-adi-tanimlayin/">Duckdns ile Dinamik IP adresinize Alan adi tanimlayin.</a>



<a class="list-group-item" href="/How-to-use-Github-Pages-for-static-website/">How to use Github Pages for static website</a>



<a class="list-group-item" href="/IdentityServer-nedir/">IdentityServer Nedir</a>



<a class="list-group-item" href="/JMETER-NOTLARI-KURULUM-VE-KULLANIM/">JMater notlari, kurulum ve kullanim</a>



<a class="list-group-item" href="/Learn-Jekyll-in-12-Steps/">Learn Jekyll in 12 Steps</a>



<a class="list-group-item" href="/OAuth-2-nedir/">OAuth 2.0  Nedir  (RFC6749)</a>



<a class="list-group-item" href="/SQL-Table-Data-Compare/">SQL table data compare, and prepare insert satements</a>



<a class="list-group-item" href="/Sql-server-icin-maliyetli-sorgularin-tespit-edilmesi/">Sql server icin maliyetli sorgularin tespit edilmesi</a>



<a class="list-group-item" href="/automater-ile-application-yapmak/">Automater ile application yapmak</a>



<a class="list-group-item" href="/docker-cok-kullanilan-komutlar/">Docker Cok kullanilan komutlar</a>



<a class="list-group-item" href="/docker-nginx-mdwiki/">Docker Nginx mdwiki</a>



<a class="list-group-item" href="/guvenli-kod-gelistirme/">Guvenlik Kod Gelistirme</a>



<a class="list-group-item" href="/redis-kurulum-ayarlar/">Redis Kurulumu ve ayarlari</a>



<a class="list-group-item" href="/tfs-deployment/">TFS ile Otomatik deployment yapmak</a>


</div>


<div class="panel panel-default" style="margin-bottom:0px;">
 <div class="panel-heading">
   <h4 class="panel-title">Yakında Hazırlanacak</h4>
 </div>
  <a class="list-group-item" href="#">Mac OS  bilgisayarda Wine kullanimi ve Wine icin tavsiye programlar.</a>
  <a class="list-group-item" href="#">Mac icin tavsiye programlar</a>
  <a class="list-group-item" href="#">Atom icin tavsiye pluginler</a>
  <a class="list-group-item" href="#">Chain of responsibility Design Pattern</a>
  <a class="list-group-item" href="#">Kurumsal yazilmlarda kullanilan Design Pattern'ler</a>
  <a class="list-group-item" href="#">Kurumsal yazilimlarda Cache kullanimi</a>
</div>
<div class="list-group">

<a class="list-group-item" href="#"></a>


</div>

<!--

<div class="panel panel-default" style="margin-bottom:0px;">
  <div class="panel-heading">
    <h4 class="panel-title">Kategoriler</h4>
  </div>

</div>
<div class="list-group">


<a class="list-group-item" href="/Duckdns-ile-Dinamik-IP-adresinize-Alan-adi-tanimlayin/">Duckdns ile Dinamik IP adresinize Alan adi tanimlayin.</a>



<a class="list-group-item" href="/How-to-use-Github-Pages-for-static-website/">How to use Github Pages for static website</a>



<a class="list-group-item" href="/IdentityServer-nedir/">IdentityServer Nedir</a>



<a class="list-group-item" href="/JMETER-NOTLARI-KURULUM-VE-KULLANIM/">JMater notlari, kurulum ve kullanim</a>



<a class="list-group-item" href="/Learn-Jekyll-in-12-Steps/">Learn Jekyll in 12 Steps</a>



<a class="list-group-item" href="/OAuth-2-nedir/">OAuth 2.0  Nedir  (RFC6749)</a>



<a class="list-group-item" href="/SQL-Table-Data-Compare/">SQL table data compare, and prepare insert satements</a>



<a class="list-group-item" href="/Sql-server-icin-maliyetli-sorgularin-tespit-edilmesi/">Sql server icin maliyetli sorgularin tespit edilmesi</a>



<a class="list-group-item" href="/automater-ile-application-yapmak/">Automater ile application yapmak</a>



<a class="list-group-item" href="/docker-cok-kullanilan-komutlar/">Docker Cok kullanilan komutlar</a>



<a class="list-group-item" href="/docker-nginx-mdwiki/">Docker Nginx mdwiki</a>



<a class="list-group-item" href="/guvenli-kod-gelistirme/">Guvenlik Kod Gelistirme</a>



<a class="list-group-item" href="/redis-kurulum-ayarlar/">Redis Kurulumu ve ayarlari</a>



<a class="list-group-item" href="/tfs-deployment/">TFS ile Otomatik deployment yapmak</a>


</div>
-->


                </div>
                <div class="col-md-9 content">
                   <article class="markdown-body">
                    <div class="alert alert-danger">
 <strong>Not!</strong> Merhaba! bloga ilk asamada icerik olarak kendi aldigim notlari direk olarak icerige koydugum icin, icerikte bircok imla hatalasi ve yazım yanlışları bulunmaktadir, kusura bakmayın,
 en yakın zamanda üzerinden geçip düzeltmeler yapacağım. Hoşgörünüz için şimdiden teşekkür ediyorum.
</div>

                    <h1 id="identityserver-hakkinda">IdentityServer Hakkinda</h1>

<h2 id="identityserver-nedir">IdentityServer Nedir?</h2>
<ul>
  <li>IdentityServer bir SSO (Single Sign On) implementasyonudur,</li>
  <li>diger bir SSO implementasyonu olan OpenID ozelligini de beraberinde saglar.</li>
  <li>IdentityServer bir Framework tur, kurulum yapilan bir yazilim degildir.</li>
  <li>Uygulamalarin guvenligini yaparken bu framework kullanilir.
Uygulama guvenligi genis bir kavram oldugu icin, burada uzerinde duracagimiz iki ana baslik vardir.
    <ul>
      <li>SSO implementasyonu</li>
      <li>Web-API, implementasyonu</li>
    </ul>
  </li>
  <li>IdentityServer, Security Token Service yaparken kullanilan bir framework tur.</li>
  <li>IdentityServer, SSO saglarken iki protokolu implemente etmistir. OpenID ve OAuth2</li>
</ul>

<h2 id="neden-ihtiyac-duyulur">Neden ihtiyac duyulur</h2>
<ul>
  <li>Application (Uygulama) ‘larda gelellikle bir Authentication (kimlik dogrulama) islemi vardir. bu islem sirasinda kullanicidan
<code class="highlighter-rouge">kullaniciadi</code> ve <code class="highlighter-rouge">sifresi</code> sorularak, kullaniciya ait bilgiler dogrulandiktan sonra, kullanici application icine alinir.</li>
  <li>Eger birden cok application yapiyorsaniz ve ayni kullanici kitlesine hitab ediyorsaniz, tum uygulamalarda Authentication islemini
implemente (gelistirme) etmeniz gerekecektir.</li>
  <li>Belkide butun sistemlere ayni kodu kopyalayip yapistiracaksiniz, muhtemelen ayni database (veritabani) i kullanacaksiniz.
fakat bu ideal ve istenen bir yontem degildir,</li>
  <li>Authentication’un en ideal yontemi bir SSO implementasyonu kullanmaktir.
bu yontem sayesinde tek bir application, gelistirilen diger applicationlar ile haberleserek Authentication’u saglayabilmektedir.</li>
  <li>Bu yontem sayesinde, kullanicilar tum sistemler icin tek sifre kullanarak giris yapabilecektir, ayni zamanda sistemler arasinda
gecis yaparken, defalarca kullaniciadi-sifre girmek zorunda kalmayacaklar.</li>
  <li>Sonuc olarak IdentityServer, Authentication isleminin tek bir lokasyona tasinmasi ve servis haline getirilmesini saglar.
diger bir deyis ile IdentityServer,  STS (Security Token Service) rolunu ustlenmis olur.</li>
  <li>IdentityServer, diger applicationlar icin bir Authentication sevisi sunar.</li>
</ul>

<h2 id="nasil-calisir">Nasil calisir</h2>
<ul>
  <li>Kullanici, IdentityServer uzerinden bir kereye mahsus olarak login olur,
daha sonra IdentityServer kullanicinin kimligini diger application’lara iletir.</li>
  <li>IdentityServer uzerinden login olmus olan client application, daha sonra ortamdaki
diger applicationlara (ornegin Web-API) cagri yaparken, IdentityServer’dan almis oldugu Token’u da
yapmis oldugu cagriya ekler. bu sayede application cagri yapanin kimligini bilir.</li>
</ul>

<p>Bir nevi browser larda calisan cookie authentication gibi, authentication sonucu verilen ticket cookie olarak browser a kaydedilir,
daha sonra browser yaptigi tum isteklere, cagrilara cookie ‘lerini de ekleyerek istekte bulurnur, bu sayede web application, cookie’ye tam olarak guvenir.</p>

<h2 id="web-api-ile-birlikte-kullanimi">Web-API ile birlikte kullanimi</h2>
<ul>
  <li>Web-API servisi bircok application tarafindan kullanilabilir, bunlarin arasinda browser gibi cookie tutabilen
application lar da vardir, bazen ise cok ilkel applicationlar Web-API servisini kullanabilir.
bu yuzden Web-API guvenligi gelistirilirken sadece browser dusunulmemelidir.
 ve Web-API servisi cookie authentication yontemini kullanmamalidir.</li>
  <li>
    <p>Web-API servisi bir client application tarafindan cagrildigi gibi ayni zamanda bir server-side application tarafindan da cagrilabilir.</p>
  </li>
  <li>Web-API bir mobile application tarafindan da cagrilabilir. Mobil application lar da cookie desteklemeyebilir.</li>
  <li>Web-API servisi baska bir Web-API servisi tarafindan cagrilabilir.</li>
</ul>

<h2 id="piyasade-bukadar-sso--urunu-varken-neden-identityserver-kullanilmali">Piyasade Bukadar SSO  urunu varken neden IdentityServer kullanilmali.</h2>
<ul>
  <li>Ana sebep, IdentityServer bir urun degildir, bir framework tur, bu sayede kullanicilara sinirsiz ozellestirme ve tasarim esnekligi saglar,  SSO yazilimi idame edilebilir, surdurulebilir, bir ozellik kazanir.</li>
  <li>Authentication islemi sirasindaki workflow a mudehale edebilirisniz, veya tamemen kendiniz tasarlayabilirsiniz,
ornegin kullanici adi sifreden sonra bir ara islemde notifictionlari kullaniciya gosterebilirsiniz, yada, authentication islemi sirasinda bir lisans sozlesmesi onayalatabilirsiniz.
diger turlu alinan bir urunde sinirli ozellestirmeler konfigurasyonlar ile sinirlidir, bir problem olusturunda sorumlu firmadan destek alinmak zorunda kalinir. kullanan kurum icin kapali bir kutudur. mudehale edilemez.</li>
  <li>
    <p>Kullanicilar Active directory de kayitli ise</p>
  </li>
  <li>IdentityServer, standalone kullanildigi gibi ayni zamanda baska bir yazilima monte edilmis olarak ta kullanilabilir.</li>
  <li>IdentityServer icin veritabaninin bir onemi yoktur, hangi veritabani olursa olsun c# kodu ile baglanilabilir, active directory olsada farketmez.</li>
  <li>IdentityServer, yazilimsal olarak genisletilebilir.
    <h3 id="buyuk-resim">Buyuk Resim</h3>
    <p><img src="https://identityserver4.readthedocs.io/en/dev/_images/appArch.png" alt="resim" /></p>
  </li>
  <li>Browser (tarayici), web uygulamalari ile haberlersir.</li>
  <li>Web uygulamasi, Web-Api ile haberlesir.</li>
  <li>Native uygulamalar, web uygulamasi ile haberlesir,</li>
  <li>server-side uygulamalari web uygulamasi ile haberlersir.</li>
  <li>Web-Api ler Web-Api ler ile haberlesir.</li>
</ul>

<h2 id="identityserver-kullanimi">IdentityServer kullanimi</h2>
<ul>
  <li>IdentityServer ile  authentication application’u gelistirmeden once bilinmesi gereken 3 sey
1- user
2- clients
3- scopes
gelistirici IdentityServer framework une bunlari saglamasi gerekir,
Developer bu uc seyi IdentityServer a ogretmesi gerekiyor.</li>
</ul>

<p>Kurumsal  uygulamalarda genelde 3 katman olur, front-end, middle-tier ve back-end genellikle bu uc katman icinde birtakim guvnelik gereksinimleri vardir.
front-end : web uygulamasi, telefon, destop uygulamasi olabilir, burada hangi rolun onyuzde hangi kisimlara erisim yetkisi vardir bunlarin tanimlanmasi gerekir.
middle-tier: web servis, web-api, rmi, rpc yada bir library olabilir, burada genellikle bussiness is katmani bulunur. buradki guvenlik gereksinimi ise, kimin hangi methodlara erisecegi hangi modullere erisebilecegi seklinde olabilir.
back-and: veri yonetim islemlerini yapildigi katmandir. burada da farkli turdeki veritabanlari yada veri turleri bulunabilir. buralarak hangi rollerin erisim yapabilcegi tanimlanir.
bu yuzden Yetkilendirme islemlerinin bir servis olarak external (harici) bir yerde calismasi daha efektif bit yontemdir.</p>

<hr />
<h3 id="obje-modeli">Obje Modeli</h3>
<ul>
  <li>IdentityServer u anlamak icin asagidaki obje modelini bilmek gerekmektedir. (Users, Clients, Scopes)
<img src="https://identityserver4.readthedocs.io/en/dev/_images/terminology.png" alt="resim" /></li>
  <li>IdentityServer bir OpenID Connect provider (OP) dir, OpenID Connect protokoku ve OAuth2 yi destekler.</li>
  <li>IdentityServer un uslendigi rol icin farkli kaynaklarda, farkli kavramlar gorebilirsiniz, ornegin Security Token Service, Identity Provider, Authorization Server, IP-STS ve daha fazlasi.</li>
  <li>IdentityServer asagidaki ozellikleri icerir.
    <ul>
      <li>Authentication (lokal veya external provider)</li>
      <li>Session Management, oturum yonetimi saglar</li>
      <li>Manage and Authenticate Clients</li>
      <li>issue identity and access token to Clients</li>
      <li>
        <h2 id="validate-tokens">validate tokens.</h2>
        <p>OpenId ve OAuth2 cok benzer protokellerdir, aslinda OpenID protokolu, OAuth2 nin bir uzantisidir,</p>
      </li>
    </ul>
  </li>
  <li>IdentityServer projesi yapmadan once bir sertifikaya ihtiyac olacak
ornek sertifika adresi : https://github.com/IdentityServer/IdentityServer4.Samples/blob/dev/MVC%20and%20API/src/IdentityServer/idsvr3test.pfx</li>
</ul>

<p><strong>1- Users (Kullanicilar)</strong>
Kullanicilar, IdentityServer userinde kayitli bir client i kullanarak verilerine erisebilirler.
Kullanici bilgilerinin, IdentityServer a verilmesi gerekiyor</p>

<p>burada ornek olmasi acisindan InMemoryUser objesi kullanildi,</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kt">var</span> <span class="n">users</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">InMemoryUser</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">new</span> <span class="n">InMemoryUser</span><span class="p">{</span><span class="n">Subject</span> <span class="p">=</span> <span class="s">"818727"</span><span class="p">,</span> <span class="n">Username</span> <span class="p">=</span> <span class="s">"alice"</span><span class="p">,</span> <span class="n">Password</span> <span class="p">=</span> <span class="s">"alice"</span><span class="p">,</span>
        <span class="n">Claims</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Claim</span><span class="p">[]</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="s">"Alice Smith"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">GivenName</span><span class="p">,</span> <span class="s">"Alice"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">FamilyName</span><span class="p">,</span> <span class="s">"Smith"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="s">"AliceSmith@email.com"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">EmailVerified</span><span class="p">,</span> <span class="s">"true"</span><span class="p">,</span> <span class="n">ClaimValueTypes</span><span class="p">.</span><span class="n">Boolean</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">Role</span><span class="p">,</span> <span class="s">"Admin"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">Role</span><span class="p">,</span> <span class="s">"Geek"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">WebSite</span><span class="p">,</span> <span class="s">"http://alice.com"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Claim</span><span class="p">(</span><span class="n">JwtClaimTypes</span><span class="p">.</span><span class="n">Address</span><span class="p">,</span> <span class="s">@"{ 'street_address': 'One Hacker Way', 'locality': 'Heidelberg', 'postal_code': 69118,'country': 'Germany' }"</span><span class="p">,</span> <span class="n">Constants</span><span class="p">.</span><span class="n">ClaimValueTypes</span><span class="p">.</span><span class="n">Json</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

</code></pre></div></div>
<p><strong>2- Clients (Istemci uygulamalar)</strong></p>
<ul>
  <li>Clients  bir application dir ve bu application lar IdentityServer dan token isterler.</li>
  <li>Kullanici client uygulamalarini kullanarak, IdentityServer dan Authentication yapar.</li>
  <li>Client Relaying Party RP olarak ta adlandirilir.</li>
  <li>Client lar IdentityServer a kaydedilmelidir.</li>
  <li>Client cesitleri, mobil uygulamalar, masaustu uyguylamalari, SPAs, Server-side uygulamlalar,</li>
  <li>Burada dikkat edilmesi gereken kontu SPA (Single Page Application) larda OP uzerinden kimlik dogrulamasi yapmasi gerekir, ve bir client olarak kabul edilir.</li>
  <li>Cunku bu applicationlarin Web-API yi kullanmak icin token a ihtiyaclari vardir, Token alacaklari merkezi application ise IdentityServer dir.</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kt">var</span> <span class="n">clients</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Client</span><span class="p">&gt;</span>
<span class="p">{</span>
  <span class="k">new</span> <span class="n">Client</span>
  <span class="p">{</span>
      <span class="n">ClientName</span> <span class="p">=</span> <span class="s">"Client1"</span><span class="p">,</span>
      <span class="n">ClientId</span> <span class="p">=</span> <span class="s">"client1"</span><span class="p">,</span>
      <span class="n">ClientSecrets</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Secret</span><span class="p">&gt;</span>
      <span class="p">{</span>
          <span class="k">new</span> <span class="nf">Secret</span><span class="p">(</span><span class="s">"madeupsecret"</span><span class="p">.</span><span class="nf">Sha256</span><span class="p">())</span>
      <span class="p">},</span>

      <span class="n">AllowedGrantTypes</span> <span class="p">=</span> <span class="n">GrantTypes</span><span class="p">.</span><span class="n">ResourceOwnerPassword</span><span class="p">,</span>

      <span class="n">AllowedScopes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span>
      <span class="p">{</span>
          <span class="n">StandardScopes</span><span class="p">.</span><span class="n">OpenId</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
          <span class="n">StandardScopes</span><span class="p">.</span><span class="n">Profile</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
          <span class="s">"api1"</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

</code></pre></div></div>

<p><strong>3- Scopes (Korunmasi gereken veri kapsami)</strong></p>
<ul>
  <li>scope, erisilmek istenen kaynagin kendisidir. erisilmek istenilen kaynagi tanimlar</li>
  <li>cogunlukle kullanici profili yada kullanici hesap bilgileri olarak adlandirilir.</li>
  <li>client appliaction larin erismek istedikleri kaynaktir (profil),
ornegin kullanicinin email adresi, adi (yani identity scopes)</li>
  <li>Authentication esnasinda, erisilemek istenilen kaynak kimligi IdentityServer(OP) a gonderilir.</li>
  <li>iki tur scope tanimi yapilir, <strong>“Identity Scopes”</strong> ve <strong>“Resource Scopes”</strong></li>
  <li>Identity Scopes, kullanici hakkindaki kimlik bilgilerini ister</li>
  <li>
    <p>Resource Scopes, Web-Api (Resource Server) icindeki kaynaklardir, ornegin Takvim</p>
  </li>
  <li>
    <p>Ozetle IdentityServer hangi user un hangi client ile, neye erismek istedigi bilgisini istiyor, daha sonra buna gore bir Authentication Token, Access token yada her ikisini  uretiyor.</p>
  </li>
  <li>Authentication Token icinde kullanici icin gerekli minimum tanimlar vardir,</li>
  <li>
    <p>Authorization Token icinde ise, hem kullanici icin gerekli bilgiler hemde client hakkinda bilgiler bulunmaktadir.</p>
  </li>
  <li>IdentityServer bir nuget pakati olarak projeye eklenebilir durumdadir,</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">scopes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Scope</span><span class="p">&gt;</span>
  <span class="p">{</span>
      <span class="n">StandardScopes</span><span class="p">.</span><span class="n">OpenId</span><span class="p">,</span>
      <span class="n">StandardScopes</span><span class="p">.</span><span class="n">Profile</span><span class="p">,</span>

      <span class="k">new</span> <span class="n">Scope</span> <span class="c1">//erisilmek istenilen kaynak tanimi, Name, DisplayName v.b...</span>
      <span class="p">{</span>
          <span class="n">Name</span> <span class="p">=</span> <span class="s">"api1"</span><span class="p">,</span>
          <span class="n">DisplayName</span> <span class="p">=</span> <span class="s">"API 1"</span><span class="p">,</span>
          <span class="n">Description</span> <span class="p">=</span> <span class="s">"API 1 features and data"</span><span class="p">,</span>
          <span class="n">Type</span> <span class="p">=</span> <span class="n">ScopeType</span><span class="p">.</span><span class="n">Resource</span>
      <span class="p">}</span>
  <span class="p">};</span>


</code></pre></div></div>

<h3 id="identityserver4--projesi-olusturmak">IdentityServer4  projesi olusturmak</h3>
<ul>
  <li>Visual studio da yeni asp.net core web application (.net core) projesi olustur</li>
  <li>empty project olarak ac</li>
  <li>project.json icine “IdentityServer4”:”1.0.0-rc2” (guncel surum) eklenir.</li>
</ul>

<p>yukaridaki 3 ana obje tanimlandiktan sonra, IdentityServer configurasyonu,
<code class="highlighter-rouge">Startup.ConfigureService</code> methoduna eklenebilir.</p>

<p>yukarda tanimlanan 3 ana obje (user, clients ve scopes)  IdentityServer’a  verilir.
artik IdentityServer’in ayarlari tanimlanmis oldu.</p>

<p>project.json dosyasinda asagidaki dependency eklenir.</p>

<pre><code class="language-JSON"> "dependencies": {
    "Microsoft.NETCore.App": {  "version": "1.0.1",  "type": "platform" },
    "Microsoft.AspNetCore.Diagnostics": "1.0.0",    
    "Microsoft.AspNetCore.Server.IISIntegration": "1.0.0",
    "Microsoft.AspNetCore.Server.Kestrel": "1.0.1",
    "Microsoft.Extensions.Logging.Console": "1.0.0",
    "IdentityServer4": "1.0.0-rc2"
  },
</code></pre>
<p>daha sonra startup dosyasina asagidakiler eklenir.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">services</span><span class="p">.</span><span class="nf">AddDeveloperIdentityServer</span><span class="p">();</span>
  <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>son adim ise, Startup.Configure() methodu icinde application a eklemek.</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IHostingEnvironment</span> <span class="n">env</span><span class="p">,</span> <span class="n">ILoggerFactory</span> <span class="n">loggerFactory</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseIdentityServer</span><span class="p">();</span>
    <span class="c1">//.....</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>IdentityServer IISExpress uzerinde degilde, console da calistirilirsa daha kullanisli olur, console dan akan loglar cok faydalidir.
Program.cs dosyasinda asagidaki degisiklik yapilir.</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">Title</span> <span class="p">=</span> <span class="s">"IdentityServer"</span><span class="p">;</span>

        <span class="kt">var</span> <span class="n">host</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WebHostBuilder</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">UseKestrel</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">UseUrls</span><span class="p">(</span><span class="s">"http://localhost:5000"</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">UseContentRoot</span><span class="p">(</span><span class="n">Directory</span><span class="p">.</span><span class="nf">GetCurrentDirectory</span><span class="p">())</span>
            <span class="p">.</span><span class="nf">UseIISIntegration</span><span class="p">()</span>
            <span class="p">.</span><span class="n">UseStartup</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;()</span>
            <span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

        <span class="n">host</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>yukarda tanimlanmis olan scopes ve clients <code class="highlighter-rouge">Startup.ConfigureServices();</code> methodunda
sevislere eklenebilir.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// configure identity server with in-memory stores, keys, clients and scopes</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddDeveloperIdentityServer</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">AddInMemoryScopes</span><span class="p">(</span><span class="n">scopes</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">AddInMemoryClients</span><span class="p">(</span><span class="n">clients</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>calistirdiktan sonra
http://localhost:5000/.well-known/openid-configuration
adresinden IdentityServer in calisip calismadigi kontrol edilebilir.
asagidaki gibi bir sonuc gorunur, burada IdentityServer hakkinda metadata vardir.</p>

<pre><code class="language-JSON">{
  "issuer": "http://localhost:5000",
  "jwks_uri": "http://localhost:5000/.well-known/openid-configuration/jwks",
  "authorization_endpoint": "http://localhost:5000/connect/authorize",
  "token_endpoint": "http://localhost:5000/connect/token",
  "userinfo_endpoint": "http://localhost:5000/connect/userinfo",
  "end_session_endpoint": "http://localhost:5000/connect/endsession",
  "check_session_iframe": "http://localhost:5000/connect/checksession",
  "revocation_endpoint": "http://localhost:5000/connect/revocation",
  "introspection_endpoint": "http://localhost:5000/connect/introspect",
  "frontchannel_logout_supported": true,
  "frontchannel_logout_session_supported": true,
  "scopes_supported": [
    "api1"
  ],
  "claims_supported": [],
  "response_types_supported": [
    "code",
    "token",
    "id_token",
    "id_token token",
    "code id_token",
    "code token",
    "code id_token token"
  ],
  "response_modes_supported": [
    "form_post",
    "query",
    "fragment"
  ],
  "grant_types_supported": [
    "authorization_code",
    "client_credentials",
    "refresh_token",
    "implicit"
  ],
  "subject_types_supported": [
    "public"
  ],
  "id_token_signing_alg_values_supported": [
    "RS256"
  ],
  "token_endpoint_auth_methods_supported": [
    "client_secret_basic",
    "client_secret_post"
  ],
  "code_challenge_methods_supported": [
    "plain",
    "S256"
  ]
}
</code></pre>

<h2 id="identityserver-api-projesi-eklenmesi">IdentityServer API projesi eklenmesi</h2>
<p>olusturulmus olan IdentityServer prjesi haricinde birde yetkilendirilecek olan API projesini olusturalim, bu proje</p>

<p>yeniden bir ASP.net core web-api projesi olusturulur. ve launchSettings.json dosyasindan calisacagi port farkli bir port secilir biz 5001 sectik</p>

<p>Api projesine yeni bir controller eklenir. Adi IdentitiyController olarabilir.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">host</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WebHostBuilder</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">UseKestrel</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">UseUrls</span><span class="p">(</span><span class="s">"http://localhost:5001"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">UseContentRoot</span><span class="p">(</span><span class="n">Directory</span><span class="p">.</span><span class="nf">GetCurrentDirectory</span><span class="p">())</span>
                <span class="p">.</span><span class="nf">UseIISIntegration</span><span class="p">()</span>
                <span class="p">.</span><span class="n">UseStartup</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

            <span class="n">host</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">[Route("identity")]</span>
<span class="na">[Authorize]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">IdentityController</span> <span class="p">:</span> <span class="n">ControllerBase</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Get</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">JsonResult</span><span class="p">(</span><span class="k">from</span> <span class="n">c</span> <span class="k">in</span> <span class="n">User</span><span class="p">.</span><span class="n">Claims</span> <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">Value</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Bu kontroler uzerinde testler yapilabilir.</p>

<p>project.json dosyaina <code class="highlighter-rouge">"IdentityServer4.AccessTokenValidation": "1.0.1-rc2"</code> satiri eklenmelidir.
burada IdentityServer u kullanan bir client servisi kullanacagiz.</p>

<p><code class="highlighter-rouge">Startup.Configure()</code> methoduna asagidaki satirlari ekleyecegiz.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">ILoggerFactory</span> <span class="n">loggerFactory</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">loggerFactory</span><span class="p">.</span><span class="nf">AddConsole</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="s">"Logging"</span><span class="p">));</span>
    <span class="n">loggerFactory</span><span class="p">.</span><span class="nf">AddDebug</span><span class="p">();</span>

    <span class="n">app</span><span class="p">.</span><span class="nf">UseIdentityServerAuthentication</span><span class="p">(</span><span class="k">new</span> <span class="n">IdentityServerAuthenticationOptions</span>
    <span class="p">{</span>
        <span class="n">Authority</span> <span class="p">=</span> <span class="s">"http://localhost:5000"</span><span class="p">,</span>
        <span class="n">ScopeName</span> <span class="p">=</span> <span class="s">"api1"</span><span class="p">,</span>

        <span class="n">RequireHttpsMetadata</span> <span class="p">=</span> <span class="k">false</span>
    <span class="p">});</span>

    <span class="n">app</span><span class="p">.</span><span class="nf">UseMvc</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>
<p>http://localhost:5001/identity adresinden test yapildiginda
401 hatasi alindigi gorulecektir.</p>

<h2 id="identityserver-client-side-code">IdentityServer client-side code</h2>

<ul>
  <li>IdentitiyServer dan token alipi API ye request ayapacak bir console uygulamasi yapacagiz,</li>
  <li>IdentitiyServer clientlerin kullanmasi icin “identitiyModel” adinda bir library yapmistir.</li>
  <li>Console uygulamasi cookie tanimadigi icin ham olarak http request yapilacak, ve token kullanilacak.</li>
</ul>

<p>Visual Studio da bir console appliation olusturup <code class="highlighter-rouge">project.json</code> icine <code class="highlighter-rouge">"IdentityModel": "2.0.0"</code> depandenty eklenir.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">IdentityModel.Client</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">IdentityModel</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">Newtonsoft.Json.Linq</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>


<span class="k">namespace</span> <span class="nn">IdentityServerConsoleAppClient</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="nf">RequestClientCredentials</span><span class="p">();</span>

        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RequestClientCredentials</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>

                <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TokenClient</span><span class="p">(</span><span class="s">"http://localhost:5000/connect/token"</span><span class="p">,</span> <span class="s">"client"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>
                <span class="n">TokenResponse</span> <span class="n">tokenResponse</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">RequestClientCredentialsAsync</span><span class="p">(</span><span class="s">"api1"</span><span class="p">).</span><span class="n">Result</span><span class="p">;</span>

                <span class="nf">ShowResponse</span><span class="p">(</span><span class="n">tokenResponse</span><span class="p">);</span>


                <span class="c1">//call API</span>

                <span class="kt">var</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span>
                <span class="p">{</span>
                    <span class="n">BaseAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"http://localhost:5001/Identity"</span><span class="p">)</span>
                <span class="p">};</span>

                <span class="n">httpClient</span><span class="p">.</span><span class="nf">SetBearerToken</span><span class="p">(</span><span class="n">tokenResponse</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">);</span>
                <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="s">"identity"</span><span class="p">).</span><span class="n">Result</span><span class="p">;</span>

                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\n\nService claims:"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>

            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">ShowResponse</span><span class="p">(</span><span class="n">TokenResponse</span> <span class="n">response</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">response</span><span class="p">.</span><span class="n">IsError</span><span class="p">)</span>
            <span class="p">{</span>

                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Token response: "</span><span class="p">+</span><span class="n">response</span><span class="p">.</span><span class="n">Json</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"."</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nAccess Token (decoded): "</span><span class="p">);</span>

                    <span class="kt">var</span> <span class="n">parts</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'.'</span><span class="p">);</span>
                    <span class="kt">var</span> <span class="n">header</span> <span class="p">=</span> <span class="n">parts</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                    <span class="kt">var</span> <span class="n">claims</span> <span class="p">=</span> <span class="n">parts</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>

                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">JObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">Base64Url</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="n">header</span><span class="p">))));</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">JObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">Base64Url</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="n">claims</span><span class="p">))));</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">ErrorType</span> <span class="p">==</span> <span class="n">ResponseErrorType</span><span class="p">.</span><span class="n">Http</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"HTTP error: "</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"HTTP status code: "</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">HttpStatusCode</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Protocol error response:"</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">Json</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>


    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

                  </article>
                  
                    

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/IdentityServer-nedir/';
      this.page.identifier = 'http://localhost:4000/IdentityServer-nedir/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://atillatan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

 

                  
                </div>
                <aside>

              </aside>
            </div>
        </section>
            <br>
        <footer class="container">
            <div class="container" style="background-color:#f6f8fa;">
  <div class="row">

    <div class="col-md-3">
      <ul>

        <li><a href="/about/">Hakkimda</a></li>
   <li><p class="rss-subscribe"> <a href="/feed.xml">RSS</a></p></li>
      </ul>
    </div>
    <div cclass="col-md-3">
      <ul>

        <li><a href="/contact/">İletişim</a></li>

      </ul>
    </div>
    <div class="col-md-3">

    </div>
  </div>
</div>
<hr>
<div class="row-fluid">
  <div>
    <div  class="col-md-6">
      <a href="#">Kullanim kosullari</a>
      <a href="#">Gizlilik</a>
      <a href="#">Guvenlik</a>
    </div>
    <div  class="col-md-6">
      <p class="muted pull-right">© 2017 Atilla Tanrikulu.</p>
    </div>
  </div>
</div>

        </footer>
  <!--#region BASE --> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!--#endregion BASE-->

<!--#region CORE-->
<script src="/assets/js/core.js"></script>
<!--#endregion CORE-->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109069515-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-109069515-1');
  </script>

  </body>
</html>
